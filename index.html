<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ù–µ–∑–Ω–∞–∫–æ–º–∫–∞ (AnonChat)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f2f5;
            --text-primary: #1a1a1a;
            --text-secondary: #65676b;
            --accent: #e91e63;
            --accent-hover: #c2185b;
            --border: #e4e6eb;
            --my-message: #e91e63;
            --other-message: #e4e6eb;
            --my-text: white;
            --other-text: #1a1a1a;
            --success: #34c759;
            --warning: #ff9500;
            --danger: #ff3b30;
            --telegram-color: #0088cc;
            --radius: 20px;
            --radius-sm: 12px;
            --shadow: 0 4px 20px rgba(233, 30, 99, 0.15);
            --container-width: 900px;
        }

        .dark-theme {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2a;
            --bg-tertiary: #2a2a3a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --accent: #ff4081;
            --accent-hover: #ff79b0;
            --border: #3a3a4a;
            --my-message: #ff4081;
            --other-message: #2a2a3a;
            --my-text: white;
            --other-text: #ffffff;
            --success: #30d158;
            --warning: #ff9f0a;
            --danger: #ff453a;
            --telegram-color: #00aced;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        body {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* –í–µ—Ä—Å–∏—è –≤ —É–≥–ª—É */
        .version-badge {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.5;
            z-index: 9999;
            background: var(--bg-secondary);
            padding: 4px 8px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: var(--container-width);
            width: 100%;
            margin: 0 auto;
        }

        /* –®–∞–ø–∫–∞ */
        header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--bg-secondary);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 22px;
            font-weight: 700;
        }

        .logo-icon {
            color: var(--accent);
            font-size: 24px;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            line-height: 1.1;
        }

        .logo-main {
            font-size: 18px;
        }

        .logo-sub {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: normal;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .header-btn {
            background: var(--bg-tertiary);
            border: none;
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-btn:hover {
            background-color: var(--accent);
            color: white;
        }

        .notifications-btn {
            position: relative;
        }

        .notifications-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--danger);
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
        .auth-screen {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-box {
            background-color: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 40px 32px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            text-align: center;
        }

        .auth-box h2 {
            margin-bottom: 24px;
            font-size: 28px;
            color: var(--accent);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border);
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
            margin-bottom: -2px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 16px;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            font-family: inherit;
            width: 100%;
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--accent-hover);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            opacity: 0.9;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        /* –°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ */
        .terms-container {
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .terms-container h3 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .terms-container p {
            margin-bottom: 10px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .terms-container ul, .terms-container ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .terms-container li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .terms-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin: 15px 0;
            text-align: left;
        }

        .terms-checkbox input {
            margin-top: 3px;
        }

        .terms-checkbox label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email */
        .verify-email-screen {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .verify-box {
            background-color: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 40px 32px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            text-align: center;
        }

        .verify-box h2 {
            margin-bottom: 24px;
            font-size: 28px;
            color: var(--accent);
        }

        .verify-box p {
            margin-bottom: 20px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .verify-icon {
            font-size: 60px;
            color: var(--accent);
            margin-bottom: 20px;
        }

        /* –≠–∫—Ä–∞–Ω –∑–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø */
        .application-screen {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .application-box {
            background-color: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 40px 32px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            text-align: center;
        }

        .application-box h2 {
            margin-bottom: 24px;
            font-size: 28px;
            color: var(--accent);
        }

        .application-box p {
            margin-bottom: 30px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            background-color: rgba(255, 149, 0, 0.1);
            color: var(--warning);
            margin-bottom: 20px;
        }

        .status-indicator.verified {
            background-color: rgba(52, 199, 89, 0.1);
            color: var(--success);
        }

        /* –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ */
        .chat-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: var(--bg-primary);
        }

        .chat-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            background-color: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-info h2 {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .chat-info p {
            color: var(--text-secondary);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .username {
            font-weight: 600;
            font-size: 15px;
        }

        .status {
            font-size: 12px;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        .messages-container-wrapper {
            flex: 1;
            overflow: hidden;
            position: relative;
            padding-bottom: 100px;
        }

        .messages-container {
            height: 100%;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            flex-direction: column;
            max-width: 75%;
            animation: messageAppear 0.3s ease-out;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.my-message {
            align-self: flex-end;
            align-items: flex-end;
            margin-right: 10px;
        }

        .message.other-message {
            align-self: flex-start;
            align-items: flex-start;
            margin-left: 10px;
        }

        .message-bubble {
            padding: 14px 18px;
            border-radius: var(--radius);
            position: relative;
            word-wrap: break-word;
            min-width: 60px;
            max-width: 100%;
        }

        .my-message .message-bubble {
            background-color: var(--my-message);
            color: var(--my-text);
            border-bottom-right-radius: 8px;
        }

        .other-message .message-bubble {
            background-color: var(--other-message);
            color: var(--other-text);
            border-bottom-left-radius: 8px;
        }

        .message-sender {
            font-size: 12px;
            margin-bottom: 6px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .message-time {
            font-size: 11px;
            margin-top: 6px;
            opacity: 0.7;
            text-align: right;
        }

        .other-message .message-time {
            text-align: left;
        }

        .message-text {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.4;
        }

        /* –î–µ–π—Å—Ç–≤–∏—è —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ */
        .message-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
            gap: 5px;
        }

        .message-bubble:hover .message-actions {
            display: flex;
        }

        .message-action-btn {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-primary);
            opacity: 0.7;
        }

        .message-action-btn:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.2);
        }

        /* –ö–Ω–æ–ø–∫–∞ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è */
        .handshake-btn {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 8px 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.2s;
            font-weight: 500;
            margin-top: 10px;
        }

        .handshake-btn:hover {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.05);
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .message-input-container {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border);
            padding: 16px 20px;
            display: flex;
            gap: 12px;
            align-items: flex-end;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            max-width: var(--container-width);
            margin: 0 auto;
            width: 100%;
        }

        .message-input-wrapper {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            padding: 14px 50px 14px 18px;
            border: 2px solid var(--border);
            border-radius: 24px;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 16px;
            font-family: inherit;
            resize: none;
            max-height: 120px;
            min-height: 52px;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        .send-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s;
        }

        .send-btn:hover {
            background-color: var(--accent-hover);
            transform: scale(1.05);
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 28px;
            width: 100%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 15px;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--accent);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background-color: var(--bg-tertiary);
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .admin-table th {
            background-color: var(--bg-tertiary);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
        }

        .admin-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        .admin-table tr:hover {
            background-color: var(--bg-tertiary);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background-color: var(--bg-tertiary);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--accent);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–∏ */
        .handshake-notification {
            background-color: var(--bg-tertiary);
            border-left: 4px solid var(--accent);
            padding: 15px;
            margin: 10px 0;
            border-radius: var(--radius-sm);
        }

        .handshake-item {
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin: 10px 0;
            border: 1px solid var(--border);
        }

        .handshake-info {
            margin-bottom: 10px;
        }

        /* –ö–æ–Ω—Ç–∞–∫—Ç—ã */
        .contacts-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .contact-card {
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 1px solid var(--border);
            position: relative;
        }

        .contact-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--telegram-color), #00aced);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .contact-details h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }

        .contact-telegram {
            color: var(--telegram-color);
            font-size: 12px;
        }

        .contact-time {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .contact-expires {
            font-size: 12px;
            color: var(--warning);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        /* –ñ–∞–ª–æ–±—ã */
        .report-reason {
            font-size: 12px;
            color: var(--danger);
            background-color: rgba(255, 59, 48, 0.1);
            padding: 4px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }

        .hidden {
            display: none !important;
        }

        .error {
            color: var(--danger);
            background-color: rgba(255, 59, 48, 0.1);
            padding: 10px;
            border-radius: var(--radius-sm);
            margin: 10px 0;
            font-size: 14px;
        }

        .success {
            color: var(--success);
            background-color: rgba(52, 199, 89, 0.1);
            padding: 10px;
            border-radius: var(--radius-sm);
            margin: 10px 0;
            font-size: 14px;
        }

        .info {
            color: var(--warning);
            background-color: rgba(255, 149, 0, 0.1);
            padding: 10px;
            border-radius: var(--radius-sm);
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body class="light-theme">
    <!-- –ë–µ–π–¥–∂ –≤–µ—Ä—Å–∏–∏ -->
    <div class="version-badge">v.3.0</div>
    
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-user-secret logo-icon"></i>
                <div class="logo-text">
                    <div class="logo-main">–ù–µ–∑–Ω–∞–∫–æ–º–∫–∞</div>
                    <div class="logo-sub">AnonChat</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-btn hidden" id="contactsBtn" title="–ö–æ–Ω—Ç–∞–∫—Ç—ã">
                    <i class="fas fa-address-book"></i>
                </button>
                <button class="header-btn hidden notifications-btn" id="notificationsBtn" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
                    <i class="fas fa-bell"></i>
                    <span class="notifications-badge hidden" id="notificationsBadge">0</span>
                </button>
                <button class="header-btn hidden" id="profileBtn" title="–ü—Ä–æ—Ñ–∏–ª—å">
                    <i class="fas fa-user"></i>
                </button>
                <button class="header-btn hidden" id="adminBtn" title="–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="header-btn theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <div class="main-content">
            <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div class="auth-screen" id="authScreen">
                <div class="auth-box">
                    <h2>–ù–µ–∑–Ω–∞–∫–æ–º–∫–∞ (AnonChat)</h2>
                    <p style="margin-bottom: 30px; color: var(--text-secondary);">
                        –ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç —Å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è–º–∏
                    </p>
                    
                    <div class="auth-tabs">
                        <button class="auth-tab active" id="loginTab">–í—Ö–æ–¥</button>
                        <button class="auth-tab" id="registerTab">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    </div>
                    
                    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
                    <div id="loginForm">
                        <div class="form-group">
                            <label for="loginEmail"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="loginEmail" class="form-control" 
                                   placeholder="–≤–∞—à@email.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="loginPassword"><i class="fas fa-lock"></i> –ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="loginPassword" class="form-control" 
                                   placeholder="–ü–∞—Ä–æ–ª—å" required>
                        </div>
                        
                        <button class="btn btn-primary" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                        </button>
                        
                        <div id="authStatus"></div>
                    </div>
                    
                    <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                    <div id="registerForm" class="hidden">
                        <div class="form-group">
                            <label for="registerEmail"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="registerEmail" class="form-control" 
                                   placeholder="–≤–∞—à@email.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="registerPassword"><i class="fas fa-lock"></i> –ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="registerPassword" class="form-control" 
                                   placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword"><i class="fas fa-lock"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="confirmPassword" class="form-control" 
                                   placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        </div>
                        
                        <div class="terms-container">
                            <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</h3>
                            <p><strong>–ù–µ–∑–Ω–∞–∫–æ–º–∫–∞ (AnonChat)</strong> ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è.</p>
                            <p><strong>1. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è:</strong></p>
                            <ul>
                                <li>–í —á–∞—Ç–µ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ "–ê–Ω–æ–Ω–∏–º #XXX"</li>
                                <li>–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —á–∞—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∑–∞—è–≤–∫—É</li>
                                <li>–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞</li>
                            </ul>
                            <p><strong>2. –ó–∞–ø—Ä–µ—â–µ–Ω–æ:</strong></p>
                            <ul>
                                <li>–°–ø–∞–º, —Ñ–ª—É–¥, —Ä–µ–∫–ª–∞–º–∞</li>
                                <li>–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, —É–≥—Ä–æ–∑—ã, —Ç—Ä–∞–≤–ª—è</li>
                                <li>–†–∞–∑–∂–∏–≥–∞–Ω–∏–µ –Ω–µ–Ω–∞–≤–∏—Å—Ç–∏, –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è</li>
                                <li>–ù–µ–∑–∞–∫–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, —ç–∫—Å—Ç—Ä–µ–º–∏–∑–º</li>
                                <li>–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ, —Ñ–∏—à–∏–Ω–≥</li>
                            </ul>
                            <p><strong>3. –°–∏—Å—Ç–µ–º–∞ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–π:</strong></p>
                            <ul>
                                <li>–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–±–º–µ–Ω—è—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É ü§ù –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º</li>
                                <li>–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∑–∞–∏–º–Ω–æ–º —Å–æ–≥–ª–∞—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                                <li>–ö–æ–Ω—Ç–∞–∫—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è 24 —á–∞—Å–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ —É–¥–∞–ª—è—é—Ç—Å—è</li>
                                <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –æ–±–º–µ–Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏</li>
                            </ul>
                            <p><strong>4. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:</strong></p>
                            <ul>
                                <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª</li>
                                <li>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ—Å–µ—Ç –ø–æ–ª–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤ —á–∞—Ç–µ</li>
                                <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –æ–±–º–µ–Ω–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏</li>
                            </ul>
                            <p><strong>5. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</strong></p>
                            <ul>
                                <li>–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —à–∏—Ñ—Ä—É—é—Ç—Å—è –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ</li>
                                <li>Telegram username –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–π</li>
                                <li>–í–∞—à email –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º</li>
                            </ul>
                        </div>
                        
                        <div class="terms-checkbox">
                            <input type="checkbox" id="agreeTerms" required>
                            <label for="agreeTerms">–Ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é, —á—Ç–æ –º–Ω–µ –∏—Å–ø–æ–ª–Ω–∏–ª–æ—Å—å 18 –ª–µ—Ç, –ø—Ä–æ—á–∏—Ç–∞–ª(–∞) –∏ —Å–æ–≥–ª–∞—Å–µ–Ω(–Ω–∞) —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º</label>
                        </div>
                        
                        <button class="btn btn-primary" id="registerBtn">
                            <i class="fas fa-user-plus"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                        </button>
                        
                        <div id="registerStatus"></div>
                    </div>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email -->
            <div class="verify-email-screen hidden" id="verifyEmailScreen">
                <div class="verify-box">
                    <div class="verify-icon">
                        <i class="fas fa-envelope-circle-check"></i>
                    </div>
                    <h2>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–∞—à Email</h2>
                    <p>
                        –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –Ω–∞ –∞–¥—Ä–µ—Å<br>
                        <strong id="verifyEmailAddress">email@example.com</strong>
                    </p>
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 30px;">
                        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
                    </p>
                    
                    <button class="btn btn-primary" id="resendVerifyBtn" style="margin-top: 20px;">
                        <i class="fas fa-redo"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ
                    </button>
                    
                    <button class="btn" id="checkVerifyBtn" style="margin-top: 10px; background: var(--bg-tertiary);">
                        <i class="fas fa-check-circle"></i> –Ø –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª email
                    </button>
                    
                    <button class="btn" id="logoutFromVerifyBtn" style="margin-top: 10px; background: var(--bg-tertiary);">
                        <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                    </button>
                    
                    <div id="verifyStatus"></div>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –∑–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø -->
            <div class="application-screen hidden" id="applicationScreen">
                <div class="application-box">
                    <h2>–ó–∞—è–≤–∫–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ —á–∞—Ç—É</h2>
                    <p>
                        –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–Ω–æ–Ω–∏–º–Ω–æ–º—É —á–∞—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞—è–≤–∫—É.<br>
                        –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –µ—ë –≤ —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ.
                    </p>
                    
                    <div class="status-indicator" id="applicationStatus">
                        <i class="fas fa-clock"></i> –ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                    </div>
                    
                    <div class="form-group">
                        <label for="telegramUsername">
                            <i class="fab fa-telegram" style="color: var(--telegram-color);"></i> 
                            –í–∞—à Telegram username
                        </label>
                        <input type="text" id="telegramUsername" class="form-control" 
                               placeholder="@username (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å @)" required>
                        <small style="color: var(--text-secondary); display: block; margin-top: 6px;">
                            –≠—Ç–æ—Ç username –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–≤—è–∑–∏ –ø—Ä–∏ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–∏. –ö–∞–∂–¥—ã–π Telegram –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–π –∑–∞—è–≤–∫–µ.
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="applicationNote">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <textarea id="applicationNote" class="form-control" 
                                  placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –æ —Å–µ–±–µ..." 
                                  rows="3"></textarea>
                    </div>
                    
                    <div class="handshake-notification">
                        <i class="fas fa-handshake" style="color: var(--accent); margin-right: 8px;"></i>
                        –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ–±—â–∞—Ç—å—Å—è –≤ —á–∞—Ç–µ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –¥—Ä—É–≥–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º. –†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∑–∞–∏–º–Ω–æ–º —Å–æ–≥–ª–∞—Å–∏–∏.
                    </div>
                    
                    <button class="btn btn-primary" id="submitApplicationBtn">
                        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
                    </button>
                    
                    <button class="btn" id="logoutFromAppBtn" style="margin-top: 10px; background: var(--bg-tertiary);">
                        <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                    </button>
                    
                    <div id="applicationStatusMessage"></div>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ -->
            <div class="chat-screen hidden" id="chatScreen">
                <div class="chat-container">
                    <div class="chat-header">
                        <div class="chat-info">
                            <h2>–ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç "–ù–µ–∑–Ω–∞–∫–æ–º–∫–∞"</h2>
                            <p>
                                <i class="fas fa-users"></i>
                                <span id="onlineCount">0</span> –æ–Ω–ª–∞–π–Ω ‚Ä¢ 
                                <i class="fas fa-clock"></i>
                                –°–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
                            </p>
                        </div>
                        <div class="user-info">
                            <div class="user-avatar" id="userAvatar">–ê</div>
                            <div class="user-details">
                                <div class="username" id="displayUsername">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                                <div class="status">
                                    <i class="fas fa-circle"></i> <span id="userStatus">–û–Ω–ª–∞–π–Ω</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="messages-container-wrapper">
                        <div class="messages-container" id="messagesContainer">
                            <!-- –°–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–¥–µ—Å—å -->
                        </div>
                    </div>

                    <div class="message-input-container">
                        <div class="message-input-wrapper">
                            <textarea class="message-input" id="messageInput" 
                                      placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ... (Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, Shift+Enter –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)"
                                      rows="1"></textarea>
                        </div>
                        <button class="send-btn" id="sendBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
                <button class="modal-close" id="closeProfileBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="user-avatar" style="width: 80px; height: 80px; margin: 0 auto 15px; font-size: 32px;" id="profileAvatar">
                        –ê
                    </div>
                    <h3 id="profileName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                    <p style="color: var(--text-secondary);" id="profileEmail">
                        email@example.com
                    </p>
                    <div id="profileStatus" class="status-indicator" style="margin-top: 10px;">
                        <i class="fas fa-clock"></i> –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                    </div>
                    <p style="color: var(--text-secondary); font-size: 12px; margin-top: 5px;">
                        ID: <span id="profileUserId">000</span>
                    </p>
                    <p style="color: var(--telegram-color); font-size: 14px; margin-top: 10px;">
                        <i class="fab fa-telegram"></i> 
                        <span id="profileTelegram">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                    </p>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button class="btn" id="logoutBtn" style="background: var(--danger); color: white; padding: 12px; border-radius: var(--radius-sm); border: none; cursor: pointer;">
                        <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ -->
    <div class="modal" id="contactsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ö–æ–Ω—Ç–∞–∫—Ç—ã (24 —á–∞—Å–∞)</h2>
                <button class="modal-close" id="closeContactsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="contactsContainer">
                    <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <p style="text-align: center; color: var(--text-secondary); font-size: 14px; margin-top: 20px;">
                    –ö–æ–Ω—Ç–∞–∫—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è 24 —á–∞—Å–∞ —Å –º–æ–º–µ–Ω—Ç–∞ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è, –ø–æ—Å–ª–µ —á–µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è.
                </p>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div class="modal" id="notificationsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
                <button class="modal-close" id="closeNotificationsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="notificationsContainer">
                    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
    <div class="modal" id="adminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
                <button class="modal-close" id="closeAdminBtn">&times;</button>
            </div>
            <div class="modal-body">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="stats-grid" id="adminStats">
                    <div class="stat-card">
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        <div class="stat-value" id="totalUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</div>
                        <div class="stat-value" id="onlineUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–ó–∞—è–≤–æ–∫ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</div>
                        <div class="stat-value" id="pendingApplications">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–ñ–∞–ª–æ–± –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</div>
                        <div class="stat-value" id="pendingReports">0</div>
                    </div>
                </div>

                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ -->
                <div style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
                    <button class="btn btn-sm" id="adminTabApplications">–ó–∞—è–≤–∫–∏</button>
                    <button class="btn btn-sm" id="adminTabApproved">–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</button>
                    <button class="btn btn-sm" id="adminTabBanned">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</button>
                    <button class="btn btn-sm" id="adminTabReports">–ñ–∞–ª–æ–±—ã</button>
                    <button class="btn btn-sm" id="adminTabAdmins">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</button>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫ -->
                <div id="adminApplicationsTab">
                    <h3>–ó–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø</h3>
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Telegram</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="applicationsTable">
                                <!-- –ó–∞—è–≤–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö -->
                <div id="adminApprovedTab" class="hidden">
                    <h3>–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏</h3>
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Telegram</th>
                                    <th>–î–∞—Ç–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="approvedTable">
                                <!-- –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö -->
                <div id="adminBannedTab" class="hidden">
                    <h3>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Telegram</th>
                                    <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                                    <th>–î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</th>
                                    <th>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="bannedTable">
                                <!-- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ –∂–∞–ª–æ–± -->
                <div id="adminReportsTab" class="hidden">
                    <h3>–ñ–∞–ª–æ–±—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
                    <div style="overflow-x: auto;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>–ñ–∞–ª–æ–±–∞ –æ—Ç</th>
                                    <th>–ù–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ</th>
                                    <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="reportsTable">
                                <!-- –ñ–∞–ª–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ -->
                <div id="adminAdminsTab" class="hidden">
                    <h3>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</h3>
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="addAdminEmail">–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="email" id="addAdminEmail" class="form-control" 
                                   placeholder="email@example.com" style="flex: 1;">
                            <button class="btn btn-success btn-sm" id="addAdminBtn">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>

                    <div style="overflow-x: auto; margin-top: 15px;">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTable">
                                <!-- –ê–¥–º–∏–Ω—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è -->
    <div class="modal" id="confirmHandshakeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è</h2>
                <button class="modal-close" id="closeConfirmHandshakeBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="handshakeConfirmInfo">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-success" id="confirmHandshakeBtn">
                        <i class="fas fa-handshake"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ
                    </button>
                    <button class="btn" id="cancelHandshakeBtn" style="margin-top: 10px; background: var(--bg-tertiary);">
                        <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∂–∞–ª–æ–±—ã -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ</h2>
                <button class="modal-close" id="closeReportBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É:</label>
                    <select id="reportReason" class="form-control">
                        <option value="spam">–°–ø–∞–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–∞</option>
                        <option value="insult">–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –∏–ª–∏ —É–≥—Ä–æ–∑—ã</option>
                        <option value="hate">–†–∞–∑–∂–∏–≥–∞–Ω–∏–µ –Ω–µ–Ω–∞–≤–∏—Å—Ç–∏</option>
                        <option value="illegal">–ù–µ–∑–∞–∫–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</option>
                        <option value="fraud">–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reportDetails">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                    <textarea id="reportDetails" class="form-control" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ..."></textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-danger" id="submitReportBtn">
                        <i class="fas fa-flag"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É
                    </button>
                    <button class="btn" id="cancelReportBtn" style="background: var(--bg-tertiary);">
                        <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ===
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyA-dQ8-cqE7y9VfNA3fPLF6hDO-s1OfQ4Q",
            authDomain: "neznakomka.firebaseapp.com",
            projectId: "neznakomka",
            storageBucket: "neznakomka.firebasestorage.app",
            messagingSenderId: "245961594712",
            appId: "1:245961594712:web:e1c8ba71af1289b1bc372d",
            measurementId: "G-QJ2Q13VB4T"
        };

        // === –°–û–°–¢–û–Ø–ù–ò–ï ===
        const state = {
            user: null,
            userData: null,
            isAdmin: false,
            isVerified: false,
            emailVerified: false,
            acceptedTerms: false,
            messages: [],
            onlineUsers: [],
            theme: 'light',
            pendingHandshakeTarget: null,
            reportTargetMessage: null,
            adminActiveTab: 'applications'
        };

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE ===
        let auth, db;

        function initFirebase() {
            try {
                firebase.initializeApp(FIREBASE_CONFIG);
                auth = firebase.auth();
                db = firebase.firestore();
                console.log("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
                
                // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        state.user = user;
                        state.emailVerified = user.emailVerified;
                        
                        if (!user.emailVerified) {
                            showVerifyEmailScreen();
                        } else {
                            await loadUserData();
                            
                            if (state.userData) {
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–Ω—è—Ç–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è
                                if (!state.userData.acceptedTerms) {
                                    showTermsAgreement();
                                    return;
                                }
                                
                                if (state.userData.isAdmin) {
                                    state.isAdmin = true;
                                    document.getElementById('adminBtn').classList.remove('hidden');
                                }
                                
                                if (state.userData.isVerified) {
                                    state.isVerified = true;
                                    showChatScreen();
                                    loadMessages();
                                    loadNotifications();
                                    loadContacts();
                                } else {
                                    showApplicationScreen();
                                    checkApplicationStatus();
                                }
                            }
                        }
                    } else {
                        resetState();
                        showAuthScreen();
                    }
                });
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ Firebase:", error);
            }
        }

        // === –°–ë–†–û–° –°–û–°–¢–û–Ø–ù–ò–Ø ===
        function resetState() {
            state.user = null;
            state.userData = null;
            state.isAdmin = false;
            state.isVerified = false;
            state.emailVerified = false;
            state.acceptedTerms = false;
            state.messages = [];
            state.onlineUsers = [];
            state.pendingHandshakeTarget = null;
            state.reportTargetMessage = null;
        }

        // === –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ===
        async function loadUserData() {
            if (!state.user || !db) return;
            
            try {
                const userRef = db.collection('users').doc(state.user.uid);
                const doc = await userRef.get();
                
                if (doc.exists) {
                    state.userData = doc.data();
                    state.acceptedTerms = state.userData.acceptedTerms || false;
                    updateProfileUI();
                } else {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    state.userData = {
                        email: state.user.email,
                        isAdmin: state.user.email === 'sad.spotty@gmail.com', // –ü–µ—Ä–≤—ã–π –∞–¥–º–∏–Ω
                        isVerified: false,
                        emailVerified: true,
                        acceptedTerms: false,
                        application: null,
                        telegramUsername: null,
                        createdAt: new Date().toISOString(),
                        lastSeen: new Date().toISOString(),
                        online: true,
                        anonymousId: generateAnonymousId(),
                        isBanned: false,
                        banReason: null,
                        bannedAt: null,
                        bannedBy: null
                    };
                    
                    await userRef.set(state.userData);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω
                await userRef.update({
                    lastSeen: new Date().toISOString(),
                    online: true
                });
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
            }
        }

        // === –ü–†–ò–ù–Ø–¢–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ì–û –°–û–ì–õ–ê–®–ï–ù–ò–Ø ===
        async function acceptTerms() {
            if (!state.user || !db) return;
            
            try {
                await db.collection('users').doc(state.user.uid).update({
                    acceptedTerms: true,
                    acceptedTermsAt: new Date().toISOString()
                });
                
                state.userData.acceptedTerms = true;
                state.acceptedTerms = true;
                
                showApplicationScreen();
                checkApplicationStatus();
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–≥–ª–∞—à–µ–Ω–∏—è:", error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–≥–ª–∞—à–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }

        // === –ü–û–ö–ê–ó–ê–¢–¨ –°–û–ì–õ–ê–®–ï–ù–ò–ï ===
        function showTermsAgreement() {
            const html = `
                <div class="verify-box">
                    <div class="verify-icon">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</h2>
                    
                    <div class="terms-container" style="max-height: 400px;">
                        <h3>–ù–µ–∑–Ω–∞–∫–æ–º–∫–∞ (AnonChat) ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h3>
                        <p><strong>1. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è:</strong></p>
                        <ul>
                            <li>–í —á–∞—Ç–µ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ "–ê–Ω–æ–Ω–∏–º #XXX"</li>
                            <li>–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —á–∞—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∑–∞—è–≤–∫—É</li>
                            <li>–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞</li>
                            <li>–¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç 18 –ª–µ—Ç</li>
                        </ul>
                        <p><strong>2. –ó–∞–ø—Ä–µ—â–µ–Ω–æ:</strong></p>
                        <ul>
                            <li>–°–ø–∞–º, —Ñ–ª—É–¥, —Ä–µ–∫–ª–∞–º–∞, —Ä–∞—Å—Å—ã–ª–∫–∞ —Å—Å—ã–ª–æ–∫</li>
                            <li>–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, —É–≥—Ä–æ–∑—ã, —Ç—Ä–∞–≤–ª—è, –±—É–ª–ª–∏–Ω–≥</li>
                            <li>–†–∞–∑–∂–∏–≥–∞–Ω–∏–µ –Ω–µ–Ω–∞–≤–∏—Å—Ç–∏, –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è –ø–æ –ª—é–±—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º</li>
                            <li>–ù–µ–∑–∞–∫–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, —ç–∫—Å—Ç—Ä–µ–º–∏–∑–º, –ø—Ä–æ–ø–∞–≥–∞–Ω–¥–∞</li>
                            <li>–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ, —Ñ–∏—à–∏–Ω–≥, –æ–±–º–∞–Ω</li>
                            <li>–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è</li>
                        </ul>
                        <p><strong>3. –°–∏—Å—Ç–µ–º–∞ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–π:</strong></p>
                        <ul>
                            <li>–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–±–º–µ–Ω—è—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ü§ù</li>
                            <li>–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∑–∞–∏–º–Ω–æ–º —Å–æ–≥–ª–∞—Å–∏–∏</li>
                            <li>–ö–æ–Ω—Ç–∞–∫—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è 24 —á–∞—Å–∞, –∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è</li>
                            <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</li>
                            <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –æ–±–º–µ–Ω–∞</li>
                        </ul>
                        <p><strong>4. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:</strong></p>
                        <ul>
                            <li>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ—Å–µ—Ç –ø–æ–ª–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è</li>
                            <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–ø—Ä–∞–≤–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</li>
                            <li>–í—Å–µ —Å–ø–æ—Ä–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ —Ä–µ—à–∞—é—Ç—Å—è –≤ –ø–æ–ª—å–∑—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</li>
                            <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –ª–æ–≥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ–ª—å—à–µ 24 —á–∞—Å–æ–≤</li>
                        </ul>
                        <p><strong>5. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</strong></p>
                        <ul>
                            <li>–°–æ–æ–±—â–µ–Ω–∏—è —à–∏—Ñ—Ä—É—é—Ç—Å—è –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö</li>
                            <li>Telegram username –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–π</li>
                            <li>Email –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</li>
                            <li>IP-–∞–¥—Ä–µ—Å–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è</li>
                        </ul>
                    </div>
                    
                    <div class="terms-checkbox">
                        <input type="checkbox" id="agreeTermsModal" required>
                        <label for="agreeTermsModal">–ú–Ω–µ –∏—Å–ø–æ–ª–Ω–∏–ª–æ—Å—å 18 –ª–µ—Ç, —è –ø—Ä–æ—á–∏—Ç–∞–ª(–∞) –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω(–Ω–∞) —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º</label>
                    </div>
                    
                    <button class="btn btn-primary" id="acceptTermsBtn">
                        <i class="fas fa-check-circle"></i> –ü—Ä–∏–Ω—è—Ç—å —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
                    </button>
                    
                    <button class="btn" id="rejectTermsBtn" style="margin-top: 10px; background: var(--bg-tertiary);">
                        <i class="fas fa-times"></i> –û—Ç–∫–∞–∑–∞—Ç—å—Å—è –∏ –≤—ã–π—Ç–∏
                    </button>
                </div>
            `;
            
            document.querySelector('.main-content').innerHTML = html;
            
            document.getElementById('acceptTermsBtn').addEventListener('click', async () => {
                if (!document.getElementById('agreeTermsModal').checked) {
                    alert('–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏');
                    return;
                }
                await acceptTerms();
            });
            
            document.getElementById('rejectTermsBtn').addEventListener('click', async () => {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è? –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –≤—ã—Ö–æ–¥—É –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞.')) {
                    await handleLogout();
                }
            });
        }

        // === –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ===
        async function handleRegister() {
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const agreeTerms = document.getElementById('agreeTerms');
            
            if (!email || !password || !confirmPassword) {
                showRegisterError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            if (password !== confirmPassword) {
                showRegisterError('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }
            
            if (password.length < 6) {
                showRegisterError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            if (!agreeTerms || !agreeTerms.checked) {
                showRegisterError('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ');
                return;
            }
            
            const registerBtn = document.getElementById('registerBtn');
            registerBtn.disabled = true;
            registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∏—Å—å–º–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                await user.sendEmailVerification();
                
                // –°—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏–Ω—è—Ç–∏–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è
                await db.collection('users').doc(user.uid).set({
                    email: user.email,
                    isAdmin: user.email === 'sad.spotty@gmail.com',
                    isVerified: false,
                    emailVerified: false,
                    acceptedTerms: true,
                    acceptedTermsAt: new Date().toISOString(),
                    application: null,
                    telegramUsername: null,
                    createdAt: new Date().toISOString(),
                    lastSeen: new Date().toISOString(),
                    online: true,
                    anonymousId: generateAnonymousId(),
                    isBanned: false
                });
                
                showRegisterSuccess('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                document.getElementById('verifyEmailAddress').textContent = email;
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", error);
                
                let errorMessage = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. ';
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email';
                        break;
                    case 'auth/weak-password':
                        errorMessage = '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã–π';
                        break;
                    default:
                        errorMessage += error.message;
                }
                
                showRegisterError(errorMessage);
            } finally {
                registerBtn.disabled = false;
                registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
            }
        }

        // === –í–•–û–î ===
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!email || !password) {
                showAuthError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –í—Ö–æ–¥...';
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                console.log("‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥:", email);
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error);
                
                let errorMessage = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. ';
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = '–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
                        break;
                    default:
                        errorMessage += error.message;
                }
                
                showAuthError(errorMessage);
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏';
            }
        }

        // === –ü–û–í–¢–û–†–ù–ê–Ø –û–¢–ü–†–ê–í–ö–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø EMAIL ===
        async function resendVerificationEmail() {
            if (!state.user) return;
            
            const resendBtn = document.getElementById('resendVerifyBtn');
            resendBtn.disabled = true;
            resendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            try {
                await state.user.sendEmailVerification();
                showVerifySuccess('–ü–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É.');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:", error);
                showVerifyError('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            } finally {
                resendBtn.disabled = false;
                resendBtn.innerHTML = '<i class="fas fa-redo"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ';
            }
        }

        // === –ü–†–û–í–ï–†–ö–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø EMAIL ===
        async function checkEmailVerification() {
            if (!state.user) return;
            
            const checkBtn = document.getElementById('checkVerifyBtn');
            checkBtn.disabled = true;
            checkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            try {
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ emailVerified
                await state.user.reload();
                
                if (state.user.emailVerified) {
                    state.emailVerified = true;
                    showVerifySuccess('Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω! –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...');
                    
                    // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
                    setTimeout(async () => {
                        await loadUserData();
                    }, 1500);
                } else {
                    showVerifyError('Email –µ—â–µ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É.');
                }
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ email:", error);
                showVerifyError('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            } finally {
                checkBtn.disabled = false;
                checkBtn.innerHTML = '<i class="fas fa-check-circle"></i> –Ø –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª email';
            }
        }

        // === –ü–†–û–í–ï–†–ö–ê –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–ò TELEGRAM USERNAME ===
        async function checkTelegramUsernameUnique(username) {
            if (!db) return true;
            
            try {
                const usersSnapshot = await db.collection('users')
                    .where('telegramUsername', '==', username)
                    .where('isVerified', '==', true)
                    .limit(1)
                    .get();
                
                return usersSnapshot.empty;
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ username:", error);
                return true;
            }
        }

        // === –û–¢–ü–†–ê–í–ö–ê –ó–ê–Ø–í–ö–ò ===
        async function submitApplication() {
            const telegramUsername = document.getElementById('telegramUsername').value.trim();
            const note = document.getElementById('applicationNote').value.trim();
            
            if (!telegramUsername || !telegramUsername.startsWith('@')) {
                showApplicationError('–í–≤–µ–¥–∏—Ç–µ Telegram username –≤ —Ñ–æ—Ä–º–∞—Ç–µ @username');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å Telegram username
            const isUnique = await checkTelegramUsernameUnique(telegramUsername);
            if (!isUnique) {
                showApplicationError('–≠—Ç–æ—Ç Telegram username —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥—Ä—É–≥–æ–º—É –∞–∫–∫–∞—É–Ω—Ç—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π.');
                return;
            }
            
            const submitBtn = document.getElementById('submitApplicationBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞—è–≤–∫—É
                const applicationData = {
                    telegramUsername,
                    note,
                    status: 'pending',
                    submittedAt: new Date().toISOString(),
                    userId: state.user.uid,
                    userEmail: state.user.email
                };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await db.collection('users').doc(state.user.uid).update({
                    application: applicationData,
                    telegramUsername: telegramUsername,
                    isVerified: false
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                state.userData.application = applicationData;
                state.userData.telegramUsername = telegramUsername;
                
                // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –∑–∞—è–≤–∫–∏
                await db.collection('applications').add({
                    ...applicationData,
                    reviewedBy: null,
                    reviewedAt: null
                });
                
                showApplicationSuccess('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ!');
                updateApplicationStatusUI();
                updateProfileUI();
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏:", error);
                showApplicationError('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É';
            }
        }

        // === –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê –ó–ê–Ø–í–ö–ò ===
        async function checkApplicationStatus() {
            if (!state.userData || !state.userData.application) return;
            
            const application = state.userData.application;
            const statusDiv = document.getElementById('applicationStatus');
            
            if (application.status === 'approved') {
                statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> –ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞';
                statusDiv.className = 'status-indicator verified';
                state.isVerified = true;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —á–∞—Ç —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                showApplicationSuccess('–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ —á–∞—Ç...');
                setTimeout(() => {
                    showChatScreen();
                    loadMessages();
                    loadNotifications();
                    loadContacts();
                }, 2000);
                
            } else if (application.status === 'rejected') {
                statusDiv.innerHTML = '<i class="fas fa-times-circle"></i> –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞';
                statusDiv.style.backgroundColor = 'rgba(255, 59, 48, 0.1)';
                statusDiv.style.color = 'var(--danger)';
                
                showApplicationError('–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –±—ã–ª–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.');
            } else {
                statusDiv.innerHTML = '<i class="fas fa-clock"></i> –ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏';
                statusDiv.className = 'status-indicator';
            }
        }

        // === –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ===
        async function loadAdminPanel() {
            if (!state.isAdmin || !db) return;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                await loadStats();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
                switch(state.adminActiveTab) {
                    case 'applications':
                        await loadApplications();
                        break;
                    case 'approved':
                        await loadApprovedUsers();
                        break;
                    case 'banned':
                        await loadBannedUsers();
                        break;
                    case 'reports':
                        await loadReports();
                        break;
                    case 'admins':
                        await loadAdmins();
                        break;
                }
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏:", error);
            }
        }

        async function loadStats() {
            try {
                // –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const usersSnapshot = await db.collection('users').get();
                document.getElementById('totalUsers').textContent = usersSnapshot.size;
                
                // –û–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç)
                const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);
                const onlineUsers = usersSnapshot.docs.filter(doc => {
                    const data = doc.data();
                    return data.lastSeen && new Date(data.lastSeen) > fiveMinutesAgo && !data.isBanned;
                });
                document.getElementById('onlineUsers').textContent = onlineUsers.length;
                
                // –ó–∞—è–≤–æ–∫ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                const pendingApps = await db.collection('applications')
                    .where('status', '==', 'pending')
                    .get();
                document.getElementById('pendingApplications').textContent = pendingApps.size;
                
                // –ñ–∞–ª–æ–± –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                const pendingReports = await db.collection('reports')
                    .where('status', '==', 'pending')
                    .get();
                document.getElementById('pendingReports').textContent = pendingReports.size;
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", error);
            }
        }

        async function loadApplications() {
            try {
                const snapshot = await db.collection('applications')
                    .orderBy('submittedAt', 'desc')
                    .get();
                
                const tbody = document.getElementById('applicationsTable');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const app = doc.data();
                    const row = document.createElement('tr');
                    
                    let statusBadge = '';
                    switch (app.status) {
                        case 'pending':
                            statusBadge = '<span style="color: var(--warning);">‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</span>';
                            break;
                        case 'approved':
                            statusBadge = '<span style="color: var(--success);">‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ</span>';
                            break;
                        case 'rejected':
                            statusBadge = '<span style="color: var(--danger);">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>';
                            break;
                    }
                    
                    const deleteBtn = app.status === 'pending' ? 
                        `<button class="action-btn btn-danger" onclick="deleteApplication('${doc.id}', '${app.userEmail}')">
                            <i class="fas fa-trash"></i>
                        </button>` : '';
                    
                    row.innerHTML = `
                        <td>${app.userEmail}</td>
                        <td>${app.telegramUsername}</td>
                        <td>${new Date(app.submittedAt).toLocaleDateString()}</td>
                        <td>${statusBadge}</td>
                        <td class="action-buttons">
                            ${app.status === 'pending' ? `
                                <button class="action-btn btn-success" onclick="reviewApplication('${doc.id}', 'approve')">
                                    –ü—Ä–∏–Ω—è—Ç—å
                                </button>
                                <button class="action-btn btn-danger" onclick="reviewApplication('${doc.id}', 'reject')">
                                    –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                </button>
                            ` : ''}
                            ${deleteBtn}
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:", error);
            }
        }

        async function loadApprovedUsers() {
            try {
                const snapshot = await db.collection('users')
                    .where('isVerified', '==', true)
                    .where('isBanned', '!=', true)
                    .get();
                
                const tbody = document.getElementById('approvedTable');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const app = user.application;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.email}</td>
                        <td>${user.telegramUsername || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                        <td>${app && app.reviewedAt ? new Date(app.reviewedAt).toLocaleDateString() : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
                        <td><span style="color: var(--success);">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span></td>
                        <td class="action-buttons">
                            <button class="action-btn btn-warning" onclick="revokeApproval('${doc.id}', '${user.email}')">
                                <i class="fas fa-ban"></i> –û—Ç–æ–∑–≤–∞—Ç—å
                            </button>
                            <button class="action-btn btn-danger" onclick="banUser('${doc.id}', '${user.email}')">
                                <i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö:", error);
            }
        }

        async function loadBannedUsers() {
            try {
                const snapshot = await db.collection('users')
                    .where('isBanned', '==', true)
                    .get();
                
                const tbody = document.getElementById('bannedTable');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const user = doc.data();
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.email}</td>
                        <td>${user.telegramUsername || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                        <td>${user.banReason || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</td>
                        <td>${user.bannedAt ? new Date(user.bannedAt).toLocaleString() : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
                        <td>${user.bannedBy || '–°–∏—Å—Ç–µ–º–∞'}</td>
                        <td class="action-buttons">
                            <button class="action-btn btn-success" onclick="unbanUser('${doc.id}', '${user.email}')">
                                <i class="fas fa-check-circle"></i> –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö:", error);
            }
        }

        async function loadReports() {
            try {
                const snapshot = await db.collection('reports')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const tbody = document.getElementById('reportsTable');
                tbody.innerHTML = '';
                
                for (const doc of snapshot.docs) {
                    const report = doc.data();
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–æ–±—â–µ–Ω–∏–∏
                    let messageText = '–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ';
                    let messageSender = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    
                    if (report.messageId) {
                        try {
                            const messageDoc = await db.collection('messages').doc(report.messageId).get();
                            if (messageDoc.exists) {
                                const messageData = messageDoc.data();
                                messageText = messageData.text.substring(0, 50) + (messageData.text.length > 50 ? '...' : '');
                                messageSender = `–ê–Ω–æ–Ω–∏–º #${messageData.anonymousId}`;
                            }
                        } catch (e) {
                            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:", e);
                        }
                    }
                    
                    const reasonText = getReportReasonText(report.reason);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${report.reporterEmail || '–ê–Ω–æ–Ω–∏–º'}</td>
                        <td>
                            <strong>–û—Ç:</strong> ${messageSender}<br>
                            <small>${messageText}</small>
                        </td>
                        <td>${reasonText}</td>
                        <td>${new Date(report.createdAt).toLocaleString()}</td>
                        <td>
                            <span style="color: ${report.status === 'pending' ? 'var(--warning)' : report.status === 'resolved' ? 'var(--success)' : 'var(--danger)'}">
                                ${report.status === 'pending' ? '‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏' : report.status === 'resolved' ? '‚úÖ –†–µ—à–µ–Ω–æ' : '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'}
                            </span>
                        </td>
                        <td class="action-buttons">
                            ${report.status === 'pending' ? `
                                <button class="action-btn btn-success" onclick="resolveReport('${doc.id}', 'resolved')">
                                    –†–µ—à–µ–Ω–æ
                                </button>
                                <button class="action-btn btn-danger" onclick="resolveReport('${doc.id}', 'rejected')">
                                    –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                </button>
                                <button class="action-btn btn-warning" onclick="deleteMessageFromReport('${doc.id}', '${report.messageId}')">
                                    –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
                                </button>
                            ` : ''}
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                }
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂–∞–ª–æ–±:", error);
            }
        }

        async function loadAdmins() {
            try {
                const snapshot = await db.collection('users')
                    .where('isAdmin', '==', true)
                    .get();
                
                const tbody = document.getElementById('adminsTable');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const isCurrentUser = doc.id === state.user.uid;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.email}</td>
                        <td>${isCurrentUser ? 'üëë –ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'}</td>
                        <td class="action-buttons">
                            ${!isCurrentUser ? `
                                <button class="action-btn btn-danger" onclick="removeAdmin('${doc.id}', '${user.email}')">
                                    –£–¥–∞–ª–∏—Ç—å
                                </button>
                            ` : ''}
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω–æ–≤:", error);
            }
        }

        // === –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–Ø–í–û–ö (–∞–¥–º–∏–Ω) ===
        window.reviewApplication = async function(appId, action) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${action === 'approve' ? '–æ–¥–æ–±—Ä–∏—Ç—å' : '–æ—Ç–∫–ª–æ–Ω–∏—Ç—å'} —ç—Ç—É –∑–∞—è–≤–∫—É?`)) {
                return;
            }
            
            try {
                const appRef = db.collection('applications').doc(appId);
                const appDoc = await appRef.get();
                const app = appDoc.data();
                
                const newStatus = action === 'approve' ? 'approved' : 'rejected';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞—è–≤–∫—É
                await appRef.update({
                    status: newStatus,
                    reviewedBy: state.user.email,
                    reviewedAt: new Date().toISOString()
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const updateData = {
                    'application.status': newStatus
                };
                
                if (action === 'approve') {
                    updateData.isVerified = true;
                    updateData.verifiedAt = new Date().toISOString();
                }
                
                await db.collection('users').doc(app.userId).update(updateData);
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadApplications();
                await loadStats();
                
                alert(`–ó–∞—è–≤–∫–∞ ${action === 'approve' ? '–æ–¥–æ–±—Ä–µ–Ω–∞' : '–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞'}`);
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏:", error);
                alert('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏');
            }
        };

        window.deleteApplication = async function(appId, userEmail) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É –æ—Ç ${userEmail}?`)) {
                return;
            }
            
            try {
                await db.collection('applications').doc(appId).delete();
                await loadApplications();
                await loadStats();
                alert('–ó–∞—è–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∏:", error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∏');
            }
        };

        window.revokeApproval = async function(userId, userEmail) {
            if (!confirm(`–û—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userEmail}?`)) {
                return;
            }
            
            try {
                await db.collection('users').doc(userId).update({
                    isVerified: false,
                    'application.status': 'revoked'
                });
                
                await loadApprovedUsers();
                await loadStats();
                alert('–î–æ—Å—Ç—É–ø –æ—Ç–æ–∑–≤–∞–Ω');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∑—ã–≤–∞ –¥–æ—Å—Ç—É–ø–∞:", error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–∑—ã–≤–∞ –¥–æ—Å—Ç—É–ø–∞');
            }
        };

        window.banUser = async function(userId, userEmail) {
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª');
            if (reason === null) return;
            
            if (!confirm(`–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userEmail}?\n–ü—Ä–∏—á–∏–Ω–∞: ${reason}`)) {
                return;
            }
            
            try {
                await db.collection('users').doc(userId).update({
                    isBanned: true,
                    banReason: reason,
                    bannedAt: new Date().toISOString(),
                    bannedBy: state.user.email,
                    isVerified: false
                });
                
                await loadApprovedUsers();
                await loadBannedUsers();
                await loadStats();
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:", error);
                alert('–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
        };

        window.unbanUser = async function(userId, userEmail) {
            if (!confirm(`–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userEmail}?`)) {
                return;
            }
            
            try {
                await db.collection('users').doc(userId).update({
                    isBanned: false,
                    banReason: null,
                    bannedAt: null,
                    bannedBy: null
                });
                
                await loadBannedUsers();
                await loadStats();
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:", error);
                alert('–û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
        };

        window.resolveReport = async function(reportId, status) {
            const statusText = status === 'resolved' ? '—Ä–µ—à–∏—Ç—å' : '–æ—Ç–∫–ª–æ–Ω–∏—Ç—å';
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${statusText} —ç—Ç—É –∂–∞–ª–æ–±—É?`)) {
                return;
            }
            
            try {
                await db.collection('reports').doc(reportId).update({
                    status: status,
                    resolvedAt: new Date().toISOString(),
                    resolvedBy: state.user.email
                });
                
                await loadReports();
                await loadStats();
                alert(`–ñ–∞–ª–æ–±–∞ ${status === 'resolved' ? '—Ä–µ—à–µ–Ω–∞' : '–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞'}`);
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∂–∞–ª–æ–±—ã:", error);
                alert('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∂–∞–ª–æ–±—ã');
            }
        };

        window.deleteMessageFromReport = async function(reportId, messageId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–º–µ—Ç–∏—Ç—å –∂–∞–ª–æ–±—É –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω—É—é?')) {
                return;
            }
            
            try {
                // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                if (messageId) {
                    await db.collection('messages').doc(messageId).delete();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∂–∞–ª–æ–±—ã
                await db.collection('reports').doc(reportId).update({
                    status: 'resolved',
                    resolvedAt: new Date().toISOString(),
                    resolvedBy: state.user.email
                });
                
                await loadReports();
                await loadStats();
                alert('–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ, –∂–∞–ª–æ–±–∞ —Ä–µ—à–µ–Ω–∞');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        };

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ê–î–ú–ò–ù–ê–ú–ò ===
        async function addAdmin() {
            const email = document.getElementById('addAdminEmail').value.trim();
            
            if (!email) {
                alert('–í–≤–µ–¥–∏—Ç–µ email');
                return;
            }
            
            try {
                // –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
                const usersSnapshot = await db.collection('users')
                    .where('email', '==', email)
                    .limit(1)
                    .get();
                
                if (usersSnapshot.empty) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                const userDoc = usersSnapshot.docs[0];
                
                // –ù–∞–∑–Ω–∞—á–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                await userDoc.ref.update({
                    isAdmin: true,
                    adminAddedAt: new Date().toISOString(),
                    adminAddedBy: state.user.email
                });
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
                document.getElementById('addAdminEmail').value = '';
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                await loadAdmins();
                
                alert('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª–µ–Ω');
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞:", error);
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
            }
        }

        window.removeAdmin = async function(userId, email) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ${email}?`)) {
                return;
            }
            
            try {
                await db.collection('users').doc(userId).update({
                    isAdmin: false
                });
                
                await loadAdmins();
                
                alert('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É–¥–∞–ª–µ–Ω');
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞:", error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
            }
        };

        // === –ó–ê–ì–†–£–ó–ö–ê –ò –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–ô ===
        function loadMessages() {
            if (!db || !state.isVerified) return;
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            document.getElementById('messagesContainer').innerHTML = '';
            
            db.collection('messages')
                .orderBy('timestamp', 'asc')
                .limit(100)
                .onSnapshot((snapshot) => {
                    const messagesContainer = document.getElementById('messagesContainer');
                    
                    snapshot.docChanges().forEach((change) => {
                        if (change.type === 'added') {
                            const message = change.doc.data();
                            message.id = change.doc.id;
                            addMessageToUI(message);
                        } else if (change.type === 'removed') {
                            // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ UI
                            const messageElement = document.querySelector(`[data-message-id="${change.doc.id}"]`);
                            if (messageElement) {
                                messageElement.remove();
                            }
                        }
                    });
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
                    scrollToBottom();
                });
        }

        async function sendMessage() {
            const text = document.getElementById('messageInput').value.trim();
            if (!text || !state.user || !state.isVerified) return;
            
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            try {
                const message = {
                    text: text,
                    userId: state.user.uid,
                    userEmail: state.user.email,
                    anonymousId: state.userData.anonymousId || generateAnonymousId(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                    deleted: false
                };
                
                await db.collection('messages').add(message);
                
                document.getElementById('messageInput').value = '';
                document.getElementById('messageInput').style.height = 'auto';
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            }
        }

        function addMessageToUI(message) {
            if (message.deleted) return;
            
            const messageElement = document.createElement('div');
            const isMyMessage = message.userId === state.user.uid;
            
            messageElement.className = `message ${isMyMessage ? 'my-message' : 'other-message'}`;
            messageElement.setAttribute('data-message-id', message.id);
            
            const time = message.timestamp?.toDate 
                ? message.timestamp.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                : new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const displayName = isMyMessage ? '–í—ã' : `–ê–Ω–æ–Ω–∏–º #${message.anonymousId || '000'}`;
            
            // –î–µ–π—Å—Ç–≤–∏—è —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
            let messageActions = '';
            if (isMyMessage) {
                messageActions = `
                    <div class="message-actions">
                        <button class="message-action-btn" onclick="deleteMessage('${message.id}')" title="–£–¥–∞–ª–∏—Ç—å">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            } else if (state.isAdmin) {
                messageActions = `
                    <div class="message-actions">
                        <button class="message-action-btn" onclick="adminDeleteMessage('${message.id}')" title="–£–¥–∞–ª–∏—Ç—å (–∞–¥–º–∏–Ω)">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="message-action-btn" onclick="reportMessage('${message.id}')" title="–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è">
                            <i class="fas fa-flag"></i>
                        </button>
                    </div>
                `;
            } else {
                messageActions = `
                    <div class="message-actions">
                        <button class="message-action-btn" onclick="reportMessage('${message.id}')" title="–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è">
                            <i class="fas fa-flag"></i>
                        </button>
                    </div>
                `;
            }
            
            // –ö–Ω–æ–ø–∫–∞ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è –¥–ª—è —á—É–∂–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            const handshakeButton = !isMyMessage && state.userData && state.userData.telegramUsername ? `
                <button class="handshake-btn" onclick="offerHandshakeConfirm(${message.anonymousId}, '${message.userId}', '${message.userEmail}')">
                    <i class="fas fa-handshake"></i> –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ
                </button>
            ` : '';
            
            messageElement.innerHTML = `
                <div class="message-sender">
                    <i class="fas ${isMyMessage ? 'fa-user' : 'fa-user-secret'}"></i> 
                    ${displayName}
                </div>
                <div class="message-bubble">
                    ${messageActions}
                    <div class="message-text">${formatMessageText(message.text)}</div>
                    <div class="message-time">${time}</div>
                </div>
                ${handshakeButton}
            `;
            
            const container = document.getElementById('messagesContainer');
            container.appendChild(messageElement);
        }

        // === –£–î–ê–õ–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–ô ===
        window.deleteMessage = async function(messageId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?')) {
                return;
            }
            
            try {
                await db.collection('messages').doc(messageId).update({
                    deleted: true,
                    deletedAt: new Date().toISOString(),
                    deletedBy: state.user.email
                });
                
                alert('–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        };

        window.adminDeleteMessage = async function(messageId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä?')) {
                return;
            }
            
            try {
                await db.collection('messages').doc(messageId).delete();
                alert('–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        };

        // === –ñ–ê–õ–û–ë–´ –ù–ê –°–û–û–ë–©–ï–ù–ò–Ø ===
        window.reportMessage = function(messageId) {
            state.reportTargetMessage = messageId;
            document.getElementById('reportModal').classList.add('active');
        };

        async function submitReport() {
            if (!state.reportTargetMessage) return;
            
            const reason = document.getElementById('reportReason').value;
            const details = document.getElementById('reportDetails').value.trim();
            
            try {
                const reportData = {
                    messageId: state.reportTargetMessage,
                    reason: reason,
                    details: details,
                    reporterId: state.user.uid,
                    reporterEmail: state.user.email,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                await db.collection('reports').add(reportData);
                
                document.getElementById('reportModal').classList.remove('active');
                state.reportTargetMessage = null;
                document.getElementById('reportReason').value = 'spam';
                document.getElementById('reportDetails').value = '';
                
                alert('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç –µ—ë –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∂–∞–ª–æ–±—ã:", error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∂–∞–ª–æ–±—ã');
            }
        }

        function getReportReasonText(reason) {
            const reasons = {
                'spam': '–°–ø–∞–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–∞',
                'insult': '–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –∏–ª–∏ —É–≥—Ä–æ–∑—ã',
                'hate': '–†–∞–∑–∂–∏–≥–∞–Ω–∏–µ –Ω–µ–Ω–∞–≤–∏—Å—Ç–∏',
                'illegal': '–ù–µ–∑–∞–∫–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç',
                'fraud': '–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ',
                'other': '–î—Ä—É–≥–æ–µ'
            };
            return reasons[reason] || reason;
        }

        // === –°–ò–°–¢–ï–ú–ê –†–£–ö–û–ü–û–ñ–ê–¢–ò–ô ===
        window.offerHandshakeConfirm = function(anonymousId, targetUserId, targetUserEmail) {
            state.pendingHandshakeTarget = { anonymousId, targetUserId, targetUserEmail };
            
            document.getElementById('handshakeConfirmInfo').innerHTML = `
                <div class="handshake-notification">
                    <h4>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è</h4>
                    <p>–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ <strong>–ê–Ω–æ–Ω–∏–º—É #${anonymousId}</strong></p>
                    <p>–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</p>
                    <ul>
                        <li>–í–∞—à Telegram (<strong>${state.userData.telegramUsername}</strong>) –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</li>
                        <li>–í—ã –ø–æ–ª—É—á–∏—Ç–µ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ—Ç–≤–µ—Ç</li>
                        <li>–ö–æ–Ω—Ç–∞–∫—Ç—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã 24 —á–∞—Å–∞</li>
                        <li>–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∑–∞–∏–º–Ω–æ–º —Å–æ–≥–ª–∞—Å–∏–∏</li>
                    </ul>
                    <p><strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –æ–±–º–µ–Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏.</strong></p>
                </div>
            `;
            
            document.getElementById('confirmHandshakeModal').classList.add('active');
        };

        async function confirmHandshake() {
            if (!state.pendingHandshakeTarget) return;
            
            const { anonymousId, targetUserId, targetUserEmail } = state.pendingHandshakeTarget;
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const targetUserDoc = await db.collection('users').doc(targetUserId).get();
                if (!targetUserDoc.exists) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                const targetUser = targetUserDoc.data();
                
                if (!targetUser.telegramUsername) {
                    alert('–£ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —É–∫–∞–∑–∞–Ω Telegram');
                    return;
                }
                
                if (targetUser.isBanned) {
                    alert('–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–∏
                const handshakeData = {
                    fromUserId: state.user.uid,
                    fromEmail: state.user.email,
                    fromTelegram: state.userData.telegramUsername,
                    fromAnonymousId: state.userData.anonymousId,
                    toUserId: targetUserId,
                    toEmail: targetUserEmail,
                    toTelegram: targetUser.telegramUsername,
                    toAnonymousId: anonymousId,
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString()
                };
                
                await db.collection('handshakes').add(handshakeData);
                
                // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await db.collection('notifications').add({
                    userId: targetUserId,
                    type: 'handshake',
                    title: '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è',
                    message: `–ê–Ω–æ–Ω–∏–º #${state.userData.anonymousId} –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ–±–º–µ–Ω—è—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏.`,
                    handshakeData: handshakeData,
                    read: false,
                    createdAt: new Date().toISOString()
                });
                
                document.getElementById('confirmHandshakeModal').classList.remove('active');
                state.pendingHandshakeTarget = null;
                
                alert('ü§ù –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è');
            }
        }

        // === –ó–ê–ì–†–£–ó–ö–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ===
        async function loadNotifications() {
            if (!state.user || !db) return;
            
            const notificationsRef = db.collection('notifications')
                .where('userId', '==', state.user.uid)
                .orderBy('createdAt', 'desc')
                .limit(20);
            
            notificationsRef.onSnapshot((snapshot) => {
                const notificationsContainer = document.getElementById('notificationsContainer');
                const badge = document.getElementById('notificationsBadge');
                
                if (!notificationsContainer) return;
                
                notificationsContainer.innerHTML = '';
                let unreadCount = 0;
                
                snapshot.forEach(doc => {
                    const notification = doc.data();
                    notification.id = doc.id;
                    
                    const notificationElement = document.createElement('div');
                    notificationElement.className = 'handshake-item';
                    notificationElement.style.opacity = notification.read ? '0.7' : '1';
                    
                    let actionButtons = '';
                    if (notification.type === 'handshake' && !notification.read) {
                        actionButtons = `
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="btn btn-success btn-sm" onclick="acceptHandshake('${notification.id}', '${notification.handshakeData.fromUserId}')">
                                    <i class="fas fa-check"></i> –ü—Ä–∏–Ω—è—Ç—å
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectHandshake('${notification.id}')">
                                    <i class="fas fa-times"></i> –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                </button>
                            </div>
                        `;
                    }
                    
                    notificationElement.innerHTML = `
                        <div class="handshake-info">
                            <strong>${notification.title}</strong>
                            <p>${notification.message}</p>
                            <small style="color: var(--text-secondary);">
                                ${new Date(notification.createdAt).toLocaleString()}
                            </small>
                        </div>
                        ${actionButtons}
                    `;
                    
                    notificationsContainer.appendChild(notificationElement);
                    
                    if (!notification.read) unreadCount++;
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            });
        }

        // === –ü–†–ò–ù–Ø–¢–ò–ï/–û–¢–ö–õ–û–ù–ï–ù–ò–ï –†–£–ö–û–ü–û–ñ–ê–¢–ò–Ø ===
        window.acceptHandshake = async function(notificationId, fromUserId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–Ω—è—Ç—å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –∏ –æ–±–º–µ–Ω—è—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏?')) {
                return;
            }
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                const notificationRef = db.collection('notifications').doc(notificationId);
                const notificationDoc = await notificationRef.get();
                const notification = notificationDoc.data();
                
                if (!notification.handshakeData) {
                    alert('–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è');
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è
                const handshakesSnapshot = await db.collection('handshakes')
                    .where('fromUserId', '==', fromUserId)
                    .where('toUserId', '==', state.user.uid)
                    .where('status', '==', 'pending')
                    .orderBy('createdAt', 'desc')
                    .limit(1)
                    .get();
                
                if (!handshakesSnapshot.empty) {
                    const handshakeDoc = handshakesSnapshot.docs[0];
                    await handshakeDoc.ref.update({
                        status: 'accepted',
                        acceptedAt: new Date().toISOString()
                    });
                }
                
                // –ü–æ–º–µ—á–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
                await notificationRef.update({ read: true });
                
                // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é
                await db.collection('notifications').add({
                    userId: fromUserId,
                    type: 'handshake_accepted',
                    title: '–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –ø—Ä–∏–Ω—è—Ç–æ',
                    message: `–ê–Ω–æ–Ω–∏–º #${state.userData.anonymousId} –ø—Ä–∏–Ω—è–ª –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è.`,
                    read: false,
                    createdAt: new Date().toISOString()
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
                await loadContacts();
                
                alert('ü§ù –†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ –ø—Ä–∏–Ω—è—Ç–æ! –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã.');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è');
            }
        };

        window.rejectHandshake = async function(notificationId) {
            if (!confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è?')) {
                return;
            }
            
            try {
                // –ü–æ–º–µ—á–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
                await db.collection('notifications').doc(notificationId).update({ read: true });
                alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è');
            }
        };

        // === –ó–ê–ì–†–£–ó–ö–ê –ö–û–ù–¢–ê–ö–¢–û–í ===
        async function loadContacts() {
            if (!state.user || !db) return;
            
            const contactsRef = db.collection('handshakes')
                .where('status', '==', 'accepted')
                .where('expiresAt', '>', new Date().toISOString())
                .where(function() {
                    return firebase.firestore.FieldPath.documentId().in([
                        ['fromUserId', '==', state.user.uid],
                        ['toUserId', '==', state.user.uid]
                    ]);
                }());
            
            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Firestore
            const fromHandshakes = await db.collection('handshakes')
                .where('fromUserId', '==', state.user.uid)
                .where('status', '==', 'accepted')
                .where('expiresAt', '>', new Date().toISOString())
                .get();
            
            const toHandshakes = await db.collection('handshakes')
                .where('toUserId', '==', state.user.uid)
                .where('status', '==', 'accepted')
                .where('expiresAt', '>', new Date().toISOString())
                .get();
            
            const allHandshakes = [...fromHandshakes.docs, ...toHandshakes.docs];
            
            const contactsContainer = document.getElementById('contactsContainer');
            if (!contactsContainer) return;
            
            contactsContainer.innerHTML = '';
            
            if (allHandshakes.length === 0) {
                contactsContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –æ—Ç —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–π</p>';
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            allHandshakes.forEach(doc => {
                const handshake = doc.data();
                const isFromMe = handshake.fromUserId === state.user.uid;
                const contact = isFromMe ? handshake.toTelegram : handshake.fromTelegram;
                const contactAnonymousId = isFromMe ? handshake.toAnonymousId : handshake.fromAnonymousId;
                
                const expiresAt = new Date(handshake.expiresAt);
                const timeLeft = Math.max(0, expiresAt - new Date());
                const hoursLeft = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                
                const contactCard = document.createElement('div');
                contactCard.className = 'contact-card';
                
                contactCard.innerHTML = `
                    <div class="contact-header">
                        <div class="contact-avatar">${contactAnonymousId % 10}</div>
                        <div class="contact-details">
                            <h4>–ê–Ω–æ–Ω–∏–º #${contactAnonymousId}</h4>
                            <p class="contact-telegram">
                                <i class="fab fa-telegram"></i> ${contact}
                            </p>
                        </div>
                    </div>
                    <div class="contact-time">
                        ${new Date(handshake.acceptedAt || handshake.createdAt).toLocaleDateString()}
                    </div>
                    <div class="contact-expires">
                        <i class="fas fa-clock"></i> –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑: ${hoursLeft}—á ${minutesLeft}–º
                    </div>
                `;
                
                contactsContainer.appendChild(contactCard);
            });
        }

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò ===
        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('verifyEmailScreen').classList.add('hidden');
            document.getElementById('applicationScreen').classList.add('hidden');
            document.getElementById('chatScreen').classList.add('hidden');
            hideHeaderButtons();
        }

        function showVerifyEmailScreen() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('verifyEmailScreen').classList.remove('hidden');
            document.getElementById('applicationScreen').classList.add('hidden');
            document.getElementById('chatScreen').classList.add('hidden');
            hideHeaderButtons();
        }

        function showApplicationScreen() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('verifyEmailScreen').classList.add('hidden');
            document.getElementById('applicationScreen').classList.remove('hidden');
            document.getElementById('chatScreen').classList.add('hidden');
            showHeaderButtons();
        }

        function showChatScreen() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('verifyEmailScreen').classList.add('hidden');
            document.getElementById('applicationScreen').classList.add('hidden');
            document.getElementById('chatScreen').classList.remove('hidden');
            showHeaderButtons();
        }

        function showHeaderButtons() {
            document.getElementById('contactsBtn').classList.remove('hidden');
            document.getElementById('notificationsBtn').classList.remove('hidden');
            document.getElementById('profileBtn').classList.remove('hidden');
        }

        function hideHeaderButtons() {
            document.getElementById('contactsBtn').classList.add('hidden');
            document.getElementById('notificationsBtn').classList.add('hidden');
            document.getElementById('profileBtn').classList.add('hidden');
            document.getElementById('adminBtn').classList.add('hidden');
        }

        // === –í–´–•–û–î ===
        async function handleLogout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                try {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ñ—Ñ–ª–∞–π–Ω
                    if (state.user && db) {
                        await db.collection('users').doc(state.user.uid).update({
                            online: false,
                            lastSeen: new Date().toISOString()
                        });
                    }
                    
                    await auth.signOut();
                    resetState();
                    
                    document.getElementById('messagesContainer').innerHTML = '';
                    closeAllModals();
                    
                    alert('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞');
                    
                } catch (error) {
                    console.error("‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", error);
                }
            }
        }

        function closeAllModals() {
            document.getElementById('profileModal').classList.remove('active');
            document.getElementById('contactsModal').classList.remove('active');
            document.getElementById('notificationsModal').classList.remove('active');
            document.getElementById('adminModal').classList.remove('active');
            document.getElementById('confirmHandshakeModal').classList.remove('active');
            document.getElementById('reportModal').classList.remove('active');
        }

        // === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
        function updateProfileUI() {
            if (!state.userData) return;
            
            const firstLetter = state.user.email ? state.user.email.charAt(0).toUpperCase() : '–ê';
            
            document.getElementById('userAvatar').textContent = firstLetter;
            document.getElementById('displayUsername').textContent = 
                state.userData.isVerified ? `–ê–Ω–æ–Ω–∏–º #${state.userData.anonymousId || '000'}` : state.user.email.split('@')[0];
            
            document.getElementById('profileAvatar').textContent = firstLetter;
            document.getElementById('profileName').textContent = state.user.email.split('@')[0];
            document.getElementById('profileEmail').textContent = state.user.email;
            document.getElementById('profileUserId').textContent = state.user.uid.substring(0, 8);
            document.getElementById('profileTelegram').textContent = 
                state.userData.telegramUsername || '–ù–µ —É–∫–∞–∑–∞–Ω';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –ø—Ä–æ—Ñ–∏–ª–µ
            const statusDiv = document.getElementById('profileStatus');
            if (state.userData.isBanned) {
                statusDiv.innerHTML = '<i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
                statusDiv.style.backgroundColor = 'rgba(255, 59, 48, 0.1)';
                statusDiv.style.color = 'var(--danger)';
            } else if (state.userData.isVerified) {
                statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> –î–æ—Å—Ç—É–ø –∫ —á–∞—Ç—É –∞–∫—Ç–∏–≤–µ–Ω';
                statusDiv.className = 'status-indicator verified';
            } else if (state.userData.application) {
                if (state.userData.application.status === 'approved') {
                    statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> –ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞';
                    statusDiv.className = 'status-indicator verified';
                } else if (state.userData.application.status === 'rejected') {
                    statusDiv.innerHTML = '<i class="fas fa-times-circle"></i> –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞';
                    statusDiv.style.backgroundColor = 'rgba(255, 59, 48, 0.1)';
                    statusDiv.style.color = 'var(--danger)';
                } else {
                    statusDiv.innerHTML = '<i class="fas fa-clock"></i> –ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏';
                    statusDiv.className = 'status-indicator';
                }
            } else {
                statusDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> –ó–∞—è–≤–∫–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞';
                statusDiv.style.backgroundColor = 'rgba(255, 149, 0, 0.1)';
                statusDiv.style.color = 'var(--warning)';
            }
        }

        function updateApplicationStatusUI() {
            const statusDiv = document.getElementById('applicationStatus');
            const application = state.userData?.application;
            
            if (application) {
                if (application.status === 'approved') {
                    statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> –ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞';
                    statusDiv.className = 'status-indicator verified';
                } else if (application.status === 'rejected') {
                    statusDiv.innerHTML = '<i class="fas fa-times-circle"></i> –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞';
                    statusDiv.style.backgroundColor = 'rgba(255, 59, 48, 0.1)';
                    statusDiv.style.color = 'var(--danger)';
                } else {
                    statusDiv.innerHTML = '<i class="fas fa-clock"></i> –ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏';
                    statusDiv.className = 'status-indicator';
                }
            } else {
                statusDiv.innerHTML = '<i class="fas fa-clock"></i> –ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏';
                statusDiv.className = 'status-indicator';
            }
        }

        function generateAnonymousId() {
            const newId = Math.floor(Math.random() * 900 + 100);
            return newId;
        }

        function formatMessageText(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;')
                .replace(/\n/g, '<br>');
        }

        function scrollToBottom() {
            setTimeout(() => {
                const container = document.getElementById('messagesContainer');
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        // === –°–û–û–ë–©–ï–ù–ò–Ø –û–ë –û–®–ò–ë–ö–ê–•/–£–°–ü–ï–•–ï ===
        function showAuthError(message) {
            const statusDiv = document.getElementById('authStatus');
            statusDiv.innerHTML = `<div class="error">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function showAuthSuccess(message) {
            const statusDiv = document.getElementById('authStatus');
            statusDiv.innerHTML = `<div class="success">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function showRegisterError(message) {
            const statusDiv = document.getElementById('registerStatus');
            statusDiv.innerHTML = `<div class="error">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function showRegisterSuccess(message) {
            const statusDiv = document.getElementById('registerStatus');
            statusDiv.innerHTML = `<div class="success">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function showVerifyError(message) {
            const statusDiv = document.getElementById('verifyStatus');
            statusDiv.innerHTML = `<div class="error">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function showVerifySuccess(message) {
            const statusDiv = document.getElementById('verifyStatus');
            statusDiv.innerHTML = `<div class="success">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function showApplicationError(message) {
            const statusDiv = document.getElementById('applicationStatusMessage');
            statusDiv.innerHTML = `<div class="error">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function showApplicationSuccess(message) {
            const statusDiv = document.getElementById('applicationStatusMessage');
            statusDiv.innerHTML = `<div class="success">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('loginTab').addEventListener('click', () => {
                document.getElementById('loginTab').classList.add('active');
                document.getElementById('registerTab').classList.remove('active');
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('registerForm').classList.add('hidden');
            });
            
            document.getElementById('registerTab').addEventListener('click', () => {
                document.getElementById('registerTab').classList.add('active');
                document.getElementById('loginTab').classList.remove('active');
                document.getElementById('registerForm').classList.remove('hidden');
                document.getElementById('loginForm').classList.add('hidden');
            });
            
            // –ö–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('registerBtn').addEventListener('click', handleRegister);
            
            document.getElementById('loginEmail').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            document.getElementById('loginPassword').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
            document.getElementById('resendVerifyBtn').addEventListener('click', resendVerificationEmail);
            document.getElementById('checkVerifyBtn').addEventListener('click', checkEmailVerification);
            document.getElementById('logoutFromVerifyBtn').addEventListener('click', handleLogout);
            
            // –ó–∞—è–≤–∫–∞
            document.getElementById('submitApplicationBtn').addEventListener('click', submitApplication);
            document.getElementById('logoutFromAppBtn').addEventListener('click', handleLogout);
            
            // –ß–∞—Ç
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            document.getElementById('messageInput').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                this.style.overflowY = this.scrollHeight > 120 ? 'auto' : 'hidden';
            });
            
            // –ö–Ω–æ–ø–∫–∏ –≤ —à–∞–ø–∫–µ
            document.getElementById('profileBtn').addEventListener('click', () => {
                document.getElementById('profileModal').classList.add('active');
            });
            
            document.getElementById('contactsBtn').addEventListener('click', () => {
                loadContacts();
                document.getElementById('contactsModal').classList.add('active');
            });
            
            document.getElementById('notificationsBtn').addEventListener('click', () => {
                document.getElementById('notificationsModal').classList.add('active');
            });
            
            document.getElementById('adminBtn').addEventListener('click', () => {
                state.adminActiveTab = 'applications';
                document.getElementById('adminModal').classList.add('active');
                loadAdminPanel();
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            document.getElementById('closeProfileBtn').addEventListener('click', () => {
                document.getElementById('profileModal').classList.remove('active');
            });
            
            document.getElementById('closeContactsBtn').addEventListener('click', () => {
                document.getElementById('contactsModal').classList.remove('active');
            });
            
            document.getElementById('closeNotificationsBtn').addEventListener('click', () => {
                document.getElementById('notificationsModal').classList.remove('active');
            });
            
            document.getElementById('closeAdminBtn').addEventListener('click', () => {
                document.getElementById('adminModal').classList.remove('active');
            });
            
            document.getElementById('closeConfirmHandshakeBtn').addEventListener('click', () => {
                document.getElementById('confirmHandshakeModal').classList.remove('active');
                state.pendingHandshakeTarget = null;
            });
            
            document.getElementById('closeReportBtn').addEventListener('click', () => {
                document.getElementById('reportModal').classList.remove('active');
                state.reportTargetMessage = null;
            });
            
            // –í—ã—Ö–æ–¥
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –≤–∫–ª–∞–¥–∫–∏
            document.getElementById('adminTabApplications').addEventListener('click', () => {
                state.adminActiveTab = 'applications';
                switchAdminTab('applications');
            });
            
            document.getElementById('adminTabApproved').addEventListener('click', () => {
                state.adminActiveTab = 'approved';
                switchAdminTab('approved');
            });
            
            document.getElementById('adminTabBanned').addEventListener('click', () => {
                state.adminActiveTab = 'banned';
                switchAdminTab('banned');
            });
            
            document.getElementById('adminTabReports').addEventListener('click', () => {
                state.adminActiveTab = 'reports';
                switchAdminTab('reports');
            });
            
            document.getElementById('adminTabAdmins').addEventListener('click', () => {
                state.adminActiveTab = 'admins';
                switchAdminTab('admins');
            });
            
            // –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
            document.getElementById('addAdminBtn').addEventListener('click', addAdmin);
            document.getElementById('addAdminEmail').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') addAdmin();
            });
            
            // –†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ
            document.getElementById('confirmHandshakeBtn').addEventListener('click', confirmHandshake);
            document.getElementById('cancelHandshakeBtn').addEventListener('click', () => {
                document.getElementById('confirmHandshakeModal').classList.remove('active');
                state.pendingHandshakeTarget = null;
            });
            
            // –ñ–∞–ª–æ–±—ã
            document.getElementById('submitReportBtn').addEventListener('click', submitReport);
            document.getElementById('cancelReportBtn').addEventListener('click', () => {
                document.getElementById('reportModal').classList.remove('active');
                state.reportTargetMessage = null;
            });
            
            // –¢–µ–º–∞
            document.getElementById('themeToggle').addEventListener('click', () => {
                const newTheme = state.theme === 'light' ? 'dark' : 'light';
                state.theme = newTheme;
                document.body.classList.toggle('dark-theme');
                document.body.classList.toggle('light-theme');
                localStorage.setItem('neznakomka-theme', newTheme);
                
                const icon = document.getElementById('themeToggle').querySelector('i');
                icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
            const savedTheme = localStorage.getItem('neznakomka-theme') || 'light';
            state.theme = savedTheme;
            document.body.classList.add(savedTheme + '-theme');
            const icon = document.getElementById('themeToggle').querySelector('i');
            icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        });

        // === –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–ò ===
        function switchAdminTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.getElementById('adminApplicationsTab').classList.add('hidden');
            document.getElementById('adminApprovedTab').classList.add('hidden');
            document.getElementById('adminBannedTab').classList.add('hidden');
            document.getElementById('adminReportsTab').classList.add('hidden');
            document.getElementById('adminAdminsTab').classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).classList.remove('hidden');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏
            loadAdminPanel();
        }
    </script>
</body>
</html>